{% extends "base.html" %}

{% block title %}üì¶ –°–ø–∏—Å–æ–∫ –ø–æ—Å—ã–ª–æ–∫{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="bi bi-box-seam"></i> –°–ø–∏—Å–æ–∫ –ø–æ—Å—ã–ª–æ–∫</h2>
    <div>
        <a href="{{ url_for('add_courier') }}" class="btn btn-success">
            <i class="bi bi-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å –ø–æ—Å—ã–ª–∫—É
        </a>
        <a href="{{ url_for('export_pdf', report_type='courier', report_name='all') }}" class="btn btn-outline-primary">
            <i class="bi bi-file-earmark-pdf"></i> –≠–∫—Å–ø–æ—Ä—Ç PDF
        </a>
    </div>
</div>

<!-- –§–∏–ª—å—Ç—Ä—ã -->
<div class="card mb-4">
    <div class="card-body">
        <form method="GET" class="row g-3" id="filterForm">
            <div class="col-md-3">
                <label class="form-label">–°—Ç–∞—Ç—É—Å</label>
                <select class="form-select" name="status">
                    <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                    <option value="–ü—Ä–∏–Ω—è—Ç–æ">–ü—Ä–∏–Ω—è—Ç–æ</option>
                    <option value="–û–±—Ä–∞–±–æ—Ç–∫–∞">–û–±—Ä–∞–±–æ—Ç–∫–∞</option>
                    <option value="–í –ø—É—Ç–∏">–í –ø—É—Ç–∏</option>
                    <option value="–í –ø—É–Ω–∫—Ç–µ –≤—ã–¥–∞—á–∏">–í –ø—É–Ω–∫—Ç–µ –≤—ã–¥–∞—á–∏</option>
                    <option value="–î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ">–î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ</option>
                    <option value="–û—Ç–º–µ–Ω–µ–Ω–æ">–û—Ç–º–µ–Ω–µ–Ω–æ</option>
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label">–û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å</label>
                <input type="text" class="form-control" name="sender" placeholder="–§–ò–û –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è">
            </div>
            <div class="col-md-3">
                <label class="form-label">–ü–æ–ª—É—á–∞—Ç–µ–ª—å</label>
                <input type="text" class="form-control" name="receiver" placeholder="–§–ò–û –ø–æ–ª—É—á–∞—Ç–µ–ª—è">
            </div>
            <div class="col-md-3">
                <label class="form-label">–¢—Ä–µ–∫ –Ω–æ–º–µ—Ä</label>
                <input type="text" class="form-control" name="tracking" placeholder="TRK...">
            </div>
            <div class="col-md-6">
                <label class="form-label">–î–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ (–æ—Ç)</label>
                <input type="date" class="form-control" name="date_from">
            </div>
            <div class="col-md-6">
                <label class="form-label">–î–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ (–¥–æ)</label>
                <input type="date" class="form-control" name="date_to">
            </div>
            <div class="col-12">
                <div class="d-flex justify-content-between">
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-funnel"></i> –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="resetFilters()">
                        <i class="bi bi-x-circle"></i> –°–±—Ä–æ—Å–∏—Ç—å
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- –¢–∞–±–ª–∏—Ü–∞ –ø–æ—Å—ã–ª–æ–∫ -->
<div class="card">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover table-striped">
                <thead>
                    <tr>
                        <th>–¢—Ä–µ–∫ –Ω–æ–º–µ—Ä</th>
                        <th>–û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å</th>
                        <th>–ü–æ–ª—É—á–∞—Ç–µ–ª—å</th>
                        <th>–í–µ—Å (–∫–≥)</th>
                        <th>–ö—É—Ä—å–µ—Ä</th>
                        <th>–î–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody>
                    {% for parcel in parcels %}
                    <tr>
                        <td>
                            <strong>{{ parcel.tracking_number if parcel.tracking_number else 'N/A' }}</strong>
                        </td>
                        <td>
                            <div class="d-flex flex-column">
                                <strong>{{ parcel.sender.full_name }}</strong>
                                <small class="text-muted">{{ parcel.sender.address[:30] }}...</small>
                            </div>
                        </td>
                        <td>
                            <div class="d-flex flex-column">
                                <strong>{{ parcel.receiver.full_name }}</strong>
                                <small class="text-muted">{{ parcel.receiver.address[:30] }}...</small>
                            </div>
                        </td>
                        <td>
                            <span class="badge bg-primary rounded-pill">{{ parcel.parcel.weight }}</span>
                        </td>
                        <td>{{ parcel.courier.name }}</td>
                        <td>{{ parcel.dates.dispatch_date }}</td>
                        <td>
                            {% if parcel.status == '–î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ' %}
                                <span class="status-badge status-delivered">
                                    <i class="bi bi-check-circle"></i> {{ parcel.status }}
                                </span>
                            {% elif parcel.status == '–í –ø—É—Ç–∏' %}
                                <span class="status-badge status-in-transit">
                                    <i class="bi bi-truck"></i> {{ parcel.status }}
                                </span>
                            {% elif parcel.status == '–û–±—Ä–∞–±–æ—Ç–∫–∞' %}
                                <span class="status-badge status-processing">
                                    <i class="bi bi-gear"></i> {{ parcel.status }}
                                </span>
                            {% elif parcel.status == '–û—Ç–º–µ–Ω–µ–Ω–æ' %}
                                <span class="status-badge status-cancelled">
                                    <i class="bi bi-x-circle"></i> {{ parcel.status }}
                                </span>
                            {% else %}
                                <span class="badge bg-secondary">{{ parcel.status }}</span>
                            {% endif %}
                        </td>
                        <td class="action-buttons">
                            <div class="btn-group" role="group">
                                <a href="{{ url_for('view_courier', id=parcel._id) }}" class="btn btn-sm btn-info" 
                                   title="–ü—Ä–æ—Å–º–æ—Ç—Ä">
                                    <i class="bi bi-eye"></i>
                                </a>
                                <a href="{{ url_for('edit_courier', id=parcel._id) }}" class="btn btn-sm btn-warning"
                                   title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                                    <i class="bi bi-pencil"></i>
                                </a>
                                <a href="{{ url_for('delete_courier', id=parcel._id) }}" 
                                   class="btn btn-sm btn-danger" 
                                   onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –ø–æ—Å—ã–ª–∫—É?')"
                                   title="–£–¥–∞–ª–∏—Ç—å">
                                    <i class="bi bi-trash"></i>
                                </a>
                            </div>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="8" class="text-center text-muted py-4">
                            <i class="bi bi-box-seam" style="font-size: 2rem;"></i>
                            <p class="mt-2">–ù–µ—Ç –ø–æ—Å—ã–ª–æ–∫ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</p>
                            <a href="{{ url_for('add_courier') }}" class="btn btn-primary mt-2">
                                <i class="bi bi-plus-circle"></i> –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—É—é –ø–æ—Å—ã–ª–∫—É
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
        {% if parcels and parcels|length > 0 %}
        <nav aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º" class="mt-4">
            <ul class="pagination justify-content-center">
                <li class="page-item disabled">
                    <a class="page-link" href="#" tabindex="-1">–ü—Ä–µ–¥—ã–¥—É—â–∞—è</a>
                </li>
                <li class="page-item active"><a class="page-link" href="#">1</a></li>
                <li class="page-item"><a class="page-link" href="#">2</a></li>
                <li class="page-item"><a class="page-link" href="#">3</a></li>
                <li class="page-item">
                    <a class="page-link" href="#">–°–ª–µ–¥—É—é—â–∞—è</a>
                </li>
            </ul>
        </nav>
        {% endif %}
        
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        {% if parcels and parcels|length > 0 %}
        <div class="mt-4 pt-4 border-top">
            <div class="row">
                <div class="col-md-3 text-center">
                    <div class="card bg-light">
                        <div class="card-body">
                            <h6 class="card-title">–í—Å–µ–≥–æ –ø–æ—Å—ã–ª–æ–∫</h6>
                            <p class="card-text display-6">{{ parcels|length }}</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 text-center">
                    <div class="card bg-light">
                        <div class="card-body">
                            <h6 class="card-title">–û–±—â–∏–π –≤–µ—Å</h6>
                            <p class="card-text display-6">
                                {{ parcels|sum(attribute='parcel.weight')|round(2) }}
                                <small class="text-muted">–∫–≥</small>
                            </p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 text-center">
                    <div class="card bg-light">
                        <div class="card-body">
                            <h6 class="card-title">–í –¥–æ—Å—Ç–∞–≤–∫–µ</h6>
                            <p class="card-text display-6">
                                {{ parcels|selectattr('status', 'equalto', '–í –ø—É—Ç–∏')|list|length }}
                            </p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 text-center">
                    <div class="card bg-light">
                        <div class="card-body">
                            <h6 class="card-title">–î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ</h6>
                            <p class="card-text display-6">
                                {{ parcels|selectattr('status', 'equalto', '–î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ')|list|length }}
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<!-- –ö–Ω–æ–ø–∫–∞ –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
<div class="fixed-bottom text-end p-3">
    <a href="{{ url_for('add_courier') }}" class="btn btn-success btn-lg rounded-pill shadow-lg" 
       style="width: 60px; height: 60px;" title="–î–æ–±–∞–≤–∏—Ç—å –ø–æ—Å—ã–ª–∫—É">
        <i class="bi bi-plus" style="font-size: 1.5rem;"></i>
    </a>
</div>
{% endblock %}

{% block extra_js %}
<script>
function resetFilters() {
    document.getElementById('filterForm').reset();
    document.getElementById('filterForm').submit();
}

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤
setInterval(function() {
    // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å AJAX –∑–∞–ø—Ä–æ—Å –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤
}, 30000); // –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
</script>
{% endblock %}