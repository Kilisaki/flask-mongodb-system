{% extends "base.html" %}

{% block title %}üìä –û—Ç—á–µ—Ç—ã –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º{% endblock %}

{% block extra_css %}
<style>
    .report-card {
        transition: transform 0.3s, box-shadow 0.3s;
        border: none;
        overflow: hidden;
    }
    
    .report-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.1);
    }
    
    .export-dropdown .dropdown-menu {
        min-width: 250px;
    }
    
    .stat-number {
        font-size: 2.5rem;
        font-weight: 700;
        color: var(--primary-color);
    }
    
    .report-section {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border-radius: 10px;
        padding: 25px;
        margin-bottom: 30px;
    }
    
    .chart-container {
        height: 300px;
        background: white;
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
    }
    
    .list-group-item {
        border: none;
        border-bottom: 1px solid #dee2e6;
    }
    
    .list-group-item:last-child {
        border-bottom: none;
    }
</style>
{% endblock %}

{% block content %}
<h2 class="mb-4"><i class="bi bi-graph-up"></i> –û—Ç—á–µ—Ç—ã –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º</h2>

<!-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
<div class="report-section">
    <h4 class="mb-4"><i class="bi bi-bar-chart"></i> –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h4>
    <div class="row">
        <div class="col-md-3 text-center mb-4">
            <div class="card report-card">
                <div class="card-body">
                    <h6 class="card-title">–í—Å–µ–≥–æ –ø–æ—Å—ã–ª–æ–∫</h6>
                    <div class="stat-number">{{ reports.general_stats.total_parcels }}</div>
                    <p class="card-text text-muted">–í —Å–∏—Å—Ç–µ–º–µ</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 text-center mb-4">
            <div class="card report-card">
                <div class="card-body">
                    <h6 class="card-title">–í—Å–µ–≥–æ –∫—É—Ä—Å–æ–≤</h6>
                    <div class="stat-number">{{ reports.general_stats.total_courses }}</div>
                    <p class="card-text text-muted">–í —Å–∏—Å—Ç–µ–º–µ</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 text-center mb-4">
            <div class="card report-card">
                <div class="card-body">
                    <h6 class="card-title">–ü–æ—Å—ã–ª–æ–∫ –≤ –ø—É—Ç–∏</h6>
                    <div class="stat-number">{{ reports.general_stats.parcels_in_transit }}</div>
                    <p class="card-text text-muted">–ê–∫—Ç–∏–≤–Ω—ã–µ –¥–æ—Å—Ç–∞–≤–∫–∏</p>
                </div>
            </div>
        </div>
        <div class="col-md-3 text-center mb-4">
            <div class="card report-card">
                <div class="card-body">
                    <h6 class="card-title">–ü—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö –∫—É—Ä—Å–æ–≤</h6>
                    <div class="stat-number">{{ reports.general_stats.upcoming_courses_count }}</div>
                    <p class="card-text text-muted">–ü–ª–∞–Ω–∏—Ä—É—é—Ç—Å—è</p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row mt-3">
        <div class="col-md-6 text-center">
            <div class="card report-card">
                <div class="card-body">
                    <h6 class="card-title">–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–æ–∫</h6>
                    <div class="stat-number">{{ reports.general_stats.total_delivery_cost|round(2) }}</div>
                    <p class="card-text text-muted">—Ä—É–±–ª–µ–π</p>
                </div>
            </div>
        </div>
        <div class="col-md-6 text-center">
            <div class="card report-card">
                <div class="card-body">
                    <h6 class="card-title">–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –∫—É—Ä—Å–æ–≤</h6>
                    <div class="stat-number">{{ reports.general_stats.total_course_price|round(2) }}</div>
                    <p class="card-text text-muted">—Ä—É–±–ª–µ–π</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –û—Ç—á–µ—Ç—ã –ø–æ –∫—É—Ä—å–µ—Ä—Å–∫–æ–π –¥–æ—Å—Ç–∞–≤–∫–µ -->
<div class="report-section">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h4><i class="bi bi-box-seam"></i> –û—Ç—á–µ—Ç—ã –ø–æ –∫—É—Ä—å–µ—Ä—Å–∫–æ–π –¥–æ—Å—Ç–∞–≤–∫–µ</h4>
        <div class="export-dropdown">
            <div class="btn-group">
                <button class="btn btn-primary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                    <i class="bi bi-download"></i> –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –æ—Ç—á–µ—Ç–æ–≤
                </button>
                <ul class="dropdown-menu">
                    <li><h6 class="dropdown-header">PDF —Ñ–æ—Ä–º–∞—Ç</h6></li>
                    <li><a class="dropdown-item" href="{{ url_for('export_pdf', report_type='courier', report_name='heavy_parcels') }}">
                        <i class="bi bi-file-earmark-pdf"></i> –¢—è–∂–µ–ª—ã–µ –ø–æ—Å—ã–ª–∫–∏
                    </a></li>
                    <li><a class="dropdown-item" href="{{ url_for('export_pdf', report_type='courier', report_name='in_transit') }}">
                        <i class="bi bi-file-earmark-pdf"></i> –ü–æ—Å—ã–ª–∫–∏ –≤ –ø—É—Ç–∏
                    </a></li>
                    <li><a class="dropdown-item" href="{{ url_for('export_pdf', report_type='courier', report_name='last_week') }}">
                        <i class="bi bi-file-earmark-pdf"></i> –ó–∞ –Ω–µ–¥–µ–ª—é
                    </a></li>
                    <li><a class="dropdown-item" href="{{ url_for('export_pdf', report_type='courier', report_name='courier_stats') }}">
                        <i class="bi bi-file-earmark-pdf"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫—É—Ä—å–µ—Ä–∞–º
                    </a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><h6 class="dropdown-header">DOCX —Ñ–æ—Ä–º–∞—Ç</h6></li>
                    <li><a class="dropdown-item" href="{{ url_for('export_docx', report_type='courier', report_name='heavy_parcels') }}">
                        <i class="bi bi-file-earmark-word"></i> –¢—è–∂–µ–ª—ã–µ –ø–æ—Å—ã–ª–∫–∏
                    </a></li>
                    <li><a class="dropdown-item" href="{{ url_for('export_docx', report_type='courier', report_name='in_transit') }}">
                        <i class="bi bi-file-earmark-word"></i> –ü–æ—Å—ã–ª–∫–∏ –≤ –ø—É—Ç–∏
                    </a></li>
                </ul>
            </div>
        </div>
    </div>
    
    <div class="row">
        <!-- –¢—è–∂–µ–ª—ã–µ –ø–æ—Å—ã–ª–∫–∏ -->
        <div class="col-md-6 mb-4">
            <div class="card report-card h-100">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">–¢—è–∂–µ–ª—ã–µ –ø–æ—Å—ã–ª–∫–∏ (>5 –∫–≥)</h5>
                    <span class="badge bg-primary">{{ reports.courier_reports.heavy_parcels|length }}</span>
                </div>
                <div class="card-body">
                    {% if reports.courier_reports.heavy_parcels %}
                        <div class="list-group list-group-flush">
                            {% for parcel in reports.courier_reports.heavy_parcels[:5] %}
                            <div class="list-group-item">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div>
                                        <h6 class="mb-1">{{ parcel.sender.full_name }} ‚Üí {{ parcel.receiver.full_name }}</h6>
                                        <small class="text-muted">–¢—Ä–µ–∫: {{ parcel.tracking_number if parcel.tracking_number else 'N/A' }}</small>
                                    </div>
                                    <span class="badge bg-warning">{{ parcel.parcel.weight }} –∫–≥</span>
                                </div>
                                <div class="mt-2">
                                    <small>
                                        <i class="bi bi-calendar"></i> {{ parcel.dates.dispatch_date }} | 
                                        <i class="bi bi-person"></i> {{ parcel.courier.name }}
                                    </small>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% if reports.courier_reports.heavy_parcels|length > 5 %}
                        <div class="text-center mt-3">
                            <small class="text-muted">... –∏ –µ—â–µ {{ reports.courier_reports.heavy_parcels|length - 5 }} –ø–æ—Å—ã–ª–æ–∫</small>
                        </div>
                        {% endif %}
                    {% else %}
                        <p class="text-muted text-center py-4">–ù–µ—Ç —Ç—è–∂–µ–ª—ã—Ö –ø–æ—Å—ã–ª–æ–∫</p>
                    {% endif %}
                    <div class="mt-3 text-center">
                        <a href="{{ url_for('export_pdf', report_type='courier', report_name='heavy_parcels') }}" 
                           class="btn btn-sm btn-outline-primary">
                            <i class="bi bi-download"></i> –°–∫–∞—á–∞—Ç—å –æ—Ç—á–µ—Ç
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –ü–æ—Å—ã–ª–∫–∏ –≤ –ø—É—Ç–∏ -->
        <div class="col-md-6 mb-4">
            <div class="card report-card h-100">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">–ü–æ—Å—ã–ª–∫–∏ –≤ –ø—É—Ç–∏</h5>
                    <span class="badge bg-warning">{{ reports.courier_reports.in_transit|length }}</span>
                </div>
                <div class="card-body">
                    {% if reports.courier_reports.in_transit %}
                        <div class="list-group list-group-flush">
                            {% for parcel in reports.courier_reports.in_transit[:5] %}
                            <div class="list-group-item">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div>
                                        <h6 class="mb-1">{{ parcel.tracking_number if parcel.tracking_number else 'N/A' }}</h6>
                                        <small class="text-muted">{{ parcel.sender.full_name }} ‚Üí {{ parcel.receiver.full_name }}</small>
                                    </div>
                                    <span class="badge bg-info">{{ parcel.status }}</span>
                                </div>
                                <div class="mt-2">
                                    <small>
                                        <i class="bi bi-calendar"></i> –î–æ—Å—Ç–∞–≤–∫–∞: {{ parcel.dates.delivery_date }} | 
                                        <i class="bi bi-truck"></i> {{ parcel.courier.name }}
                                    </small>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% if reports.courier_reports.in_transit|length > 5 %}
                        <div class="text-center mt-3">
                            <small class="text-muted">... –∏ –µ—â–µ {{ reports.courier_reports.in_transit|length - 5 }} –ø–æ—Å—ã–ª–æ–∫</small>
                        </div>
                        {% endif %}
                    {% else %}
                        <p class="text-muted text-center py-4">–ù–µ—Ç –ø–æ—Å—ã–ª–æ–∫ –≤ –ø—É—Ç–∏</p>
                    {% endif %}
                    <div class="mt-3 text-center">
                        <a href="{{ url_for('export_pdf', report_type='courier', report_name='in_transit') }}" 
                           class="btn btn-sm btn-outline-primary">
                            <i class="bi bi-download"></i> –°–∫–∞—á–∞—Ç—å –æ—Ç—á–µ—Ç
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫—É—Ä—å–µ—Ä–∞–º -->
        <div class="col-md-12 mb-4">
            <div class="card report-card">
                <div class="card-header">
                    <h5 class="mb-0">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫—É—Ä—å–µ—Ä–∞–º</h5>
                </div>
                <div class="card-body">
                    {% if reports.courier_reports.courier_stats %}
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>–ö—É—Ä—å–µ—Ä</th>
                                        <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Å—ã–ª–æ–∫</th>
                                        <th>–û–±—â–∏–π –≤–µ—Å (–∫–≥)</th>
                                        <th>–°—Ä–µ–¥–Ω–∏–π –≤–µ—Å</th>
                                        <th>–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for stat in reports.courier_reports.courier_stats %}
                                    <tr>
                                        <td>{{ stat._id or '–ù–µ —É–∫–∞–∑–∞–Ω' }}</td>
                                        <td>{{ stat.count }}</td>
                                        <td>{{ stat.total_weight|round(2) }}</td>
                                        <td>{{ (stat.total_weight/stat.count)|round(2) if stat.count > 0 else 0 }}</td>
                                        <td>{{ stat.total_cost|round(2) if stat.total_cost else 0 }} —Ä—É–±.</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <p class="text-muted text-center py-4">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ –∫—É—Ä—å–µ—Ä–∞–º</p>
                    {% endif %}
                    <div class="text-center mt-3">
                        <a href="{{ url_for('export_pdf', report_type='courier', report_name='courier_stats') }}" 
                           class="btn btn-outline-primary">
                            <i class="bi bi-download"></i> –°–∫–∞—á–∞—Ç—å –ø–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –û—Ç—á–µ—Ç—ã –ø–æ –∫—É—Ä—Å–∞–º –ø–æ–≤—ã—à–µ–Ω–∏—è –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏ -->
<div class="report-section">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h4><i class="bi bi-mortarboard"></i> –û—Ç—á–µ—Ç—ã –ø–æ –∫—É—Ä—Å–∞–º –ø–æ–≤—ã—à–µ–Ω–∏—è –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏</h4>
        <div class="export-dropdown">
            <div class="btn-group">
                <button class="btn btn-success dropdown-toggle" type="button" data-bs-toggle="dropdown">
                    <i class="bi bi-download"></i> –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –æ—Ç—á–µ—Ç–æ–≤
                </button>
                <ul class="dropdown-menu">
                    <li><h6 class="dropdown-header">PDF —Ñ–æ—Ä–º–∞—Ç</h6></li>
                    <li><a class="dropdown-item" href="{{ url_for('export_pdf', report_type='courses', report_name='upcoming_courses') }}">
                        <i class="bi bi-file-earmark-pdf"></i> –ü—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ –∫—É—Ä—Å—ã
                    </a></li>
                    <li><a class="dropdown-item" href="{{ url_for('export_pdf', report_type='courses', report_name='long_courses') }}">
                        <i class="bi bi-file-earmark-pdf"></i> –î–ª–∏—Ç–µ–ª—å–Ω—ã–µ –∫—É—Ä—Å—ã
                    </a></li>
                    <li><a class="dropdown-item" href="{{ url_for('export_pdf', report_type='courses', report_name='full_courses') }}">
                        <i class="bi bi-file-earmark-pdf"></i> –ö—É—Ä—Å—ã —Å –ø–æ–ª–Ω—ã–º–∏ –≥—Ä—É–ø–ø–∞–º–∏
                    </a></li>
                    <li><a class="dropdown-item" href="{{ url_for('export_pdf', report_type='courses', report_name='department_stats') }}">
                        <i class="bi bi-file-earmark-pdf"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –æ—Ç–¥–µ–ª–∞–º
                    </a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><h6 class="dropdown-header">DOCX —Ñ–æ—Ä–º–∞—Ç</h6></li>
                    <li><a class="dropdown-item" href="{{ url_for('export_docx', report_type='courses', report_name='upcoming_courses') }}">
                        <i class="bi bi-file-earmark-word"></i> –ü—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ –∫—É—Ä—Å—ã
                    </a></li>
                    <li><a class="dropdown-item" href="{{ url_for('export_docx', report_type='courses', report_name='long_courses') }}">
                        <i class="bi bi-file-earmark-word"></i> –î–ª–∏—Ç–µ–ª—å–Ω—ã–µ –∫—É—Ä—Å—ã
                    </a></li>
                </ul>
            </div>
        </div>
    </div>
    
    <div class="row">
        <!-- –ü—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ –∫—É—Ä—Å—ã -->
        <div class="col-md-6 mb-4">
            <div class="card report-card h-100">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">–ü—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ –∫—É—Ä—Å—ã</h5>
                    <span class="badge bg-success">{{ reports.courses_reports.upcoming_courses|length }}</span>
                </div>
                <div class="card-body">
                    {% if reports.courses_reports.upcoming_courses %}
                        <div class="list-group list-group-flush">
                            {% for course in reports.courses_reports.upcoming_courses[:5] %}
                            <div class="list-group-item">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div>
                                        <h6 class="mb-1">{{ course.course_name }}</h6>
                                        <small class="text-muted">–ö–æ–¥: {{ course.course_code if course.course_code else 'N/A' }}</small>
                                    </div>
                                    <span class="badge bg-info">{{ course.status }}</span>
                                </div>
                                <div class="mt-2">
                                    <small>
                                        <i class="bi bi-calendar"></i> {{ course.dates.start_date }} - {{ course.dates.end_date }} | 
                                        <i class="bi bi-clock"></i> {{ course.hours }} —á–∞—Å–æ–≤
                                    </small>
                                </div>
                                <div class="mt-1">
                                    <small>
                                        <i class="bi bi-person"></i> {{ course.teacher.name }} | 
                                        <i class="bi bi-people"></i> {{ course.employees|length }}/3
                                    </small>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% if reports.courses_reports.upcoming_courses|length > 5 %}
                        <div class="text-center mt-3">
                            <small class="text-muted">... –∏ –µ—â–µ {{ reports.courses_reports.upcoming_courses|length - 5 }} –∫—É—Ä—Å–æ–≤</small>
                        </div>
                        {% endif %}
                    {% else %}
                        <p class="text-muted text-center py-4">–ù–µ—Ç –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö –∫—É—Ä—Å–æ–≤</p>
                    {% endif %}
                    <div class="mt-3 text-center">
                        <a href="{{ url_for('export_pdf', report_type='courses', report_name='upcoming_courses') }}" 
                           class="btn btn-sm btn-outline-success">
                            <i class="bi bi-download"></i> –°–∫–∞—á–∞—Ç—å –æ—Ç—á–µ—Ç
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –î–ª–∏—Ç–µ–ª—å–Ω—ã–µ –∫—É—Ä—Å—ã -->
        <div class="col-md-6 mb-4">
            <div class="card report-card h-100">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">–î–ª–∏—Ç–µ–ª—å–Ω—ã–µ –∫—É—Ä—Å—ã (>40 —á–∞—Å–æ–≤)</h5>
                    <span class="badge bg-primary">{{ reports.courses_reports.long_courses|length }}</span>
                </div>
                <div class="card-body">
                    {% if reports.courses_reports.long_courses %}
                        <div class="list-group list-group-flush">
                            {% for course in reports.courses_reports.long_courses[:5] %}
                            <div class="list-group-item">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div>
                                        <h6 class="mb-1">{{ course.course_name }}</h6>
                                        <small class="text-muted">{{ course.teacher.name }}</small>
                                    </div>
                                    <span class="badge bg-warning">{{ course.hours }} —á–∞—Å–æ–≤</span>
                                </div>
                                <div class="mt-2">
                                    <small>
                                        <i class="bi bi-calendar"></i> {{ course.dates.start_date }} - {{ course.dates.end_date }} | 
                                        <i class="bi bi-cash"></i> {{ course.price|default(0, true) }} —Ä—É–±.
                                    </small>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% if reports.courses_reports.long_courses|length > 5 %}
                        <div class="text-center mt-3">
                            <small class="text-muted">... –∏ –µ—â–µ {{ reports.courses_reports.long_courses|length - 5 }} –∫—É—Ä—Å–æ–≤</small>
                        </div>
                        {% endif %}
                    {% else %}
                        <p class="text-muted text-center py-4">–ù–µ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –∫—É—Ä—Å–æ–≤</p>
                    {% endif %}
                    <div class="mt-3 text-center">
                        <a href="{{ url_for('export_pdf', report_type='courses', report_name='long_courses') }}" 
                           class="btn btn-sm btn-outline-success">
                            <i class="bi bi-download"></i> –°–∫–∞—á–∞—Ç—å –æ—Ç—á–µ—Ç
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –æ—Ç–¥–µ–ª–∞–º -->
        <div class="col-md-12 mb-4">
            <div class="card report-card">
                <div class="card-header">
                    <h5 class="mb-0">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –æ—Ç–¥–µ–ª–∞–º</h5>
                </div>
                <div class="card-body">
                    {% if reports.courses_reports.department_stats %}
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>–û—Ç–¥–µ–ª</th>
                                        <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</th>
                                        <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—É—Ä—Å–æ–≤</th>
                                        <th>–°—Ä–µ–¥–Ω–µ–µ –∫–æ–ª-–≤–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –Ω–∞ –∫—É—Ä—Å</th>
                                        <th>–ü—Ä–æ—Ü–µ–Ω—Ç —É—á–∞—Å—Ç–∏—è</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% set total_employees = reports.courses_reports.department_stats|sum(attribute='employee_count') %}
                                    {% for stat in reports.courses_reports.department_stats %}
                                    <tr>
                                        <td>{{ stat.department or '–ù–µ —É–∫–∞–∑–∞–Ω' }}</td>
                                        <td>{{ stat.employee_count }}</td>
                                        <td>{{ stat.course_count }}</td>
                                        <td>
                                            {% if stat.course_count > 0 %}
                                                {{ (stat.employee_count/stat.course_count)|round(1) }}
                                            {% else %}
                                                0
                                            {% endif %}
                                        </td>
                                        <td>
                                            {% if total_employees > 0 %}
                                                {{ ((stat.employee_count/total_employees)*100)|round(1) }}%
                                            {% else %}
                                                0%
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <p class="text-muted text-center py-4">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ –æ—Ç–¥–µ–ª–∞–º</p>
                    {% endif %}
                    <div class="text-center mt-3">
                        <a href="{{ url_for('export_pdf', report_type='courses', report_name='department_stats') }}" 
                           class="btn btn-outline-success">
                            <i class="bi bi-download"></i> –°–∫–∞—á–∞—Ç—å –ø–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –ë—ã—Å—Ç—Ä—ã–µ –æ—Ç—á–µ—Ç—ã -->
<div class="row mt-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-lightning-charge"></i> –ë—ã—Å—Ç—Ä—ã–µ –æ—Ç—á–µ—Ç—ã</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3 text-center">
                        <a href="{{ url_for('export_pdf', report_type='courier', report_name='last_week') }}" 
                           class="btn btn-outline-primary w-100 mb-3">
                            <i class="bi bi-file-earmark-pdf"></i> –ü–æ—Å—ã–ª–∫–∏ –∑–∞ –Ω–µ–¥–µ–ª—é (PDF)
                        </a>
                    </div>
                    <div class="col-md-3 text-center">
                        <a href="{{ url_for('export_docx', report_type='courier', report_name='last_week') }}" 
                           class="btn btn-outline-primary w-100 mb-3">
                            <i class="bi bi-file-earmark-word"></i> –ü–æ—Å—ã–ª–∫–∏ –∑–∞ –Ω–µ–¥–µ–ª—é (DOCX)
                        </a>
                    </div>
                    <div class="col-md-3 text-center">
                        <a href="{{ url_for('export_pdf', report_type='courses', report_name='full_courses') }}" 
                           class="btn btn-outline-success w-100 mb-3">
                            <i class="bi bi-file-earmark-pdf"></i> –ü–æ–ª–Ω—ã–µ –≥—Ä—É–ø–ø—ã (PDF)
                        </a>
                    </div>
                    <div class="col-md-3 text-center">
                        <a href="{{ url_for('export_docx', report_type='courses', report_name='full_courses') }}" 
                           class="btn btn-outline-success w-100 mb-3">
                            <i class="bi bi-file-earmark-word"></i> –ü–æ–ª–Ω—ã–µ –≥—Ä—É–ø–ø—ã (DOCX)
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ -->
<div class="row mt-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-info-circle"></i> –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ—Ç—á–µ—Ç–æ–≤:</h6>
                        <ul>
                            <li>–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≤—Å–µ–º —Ç–∏–ø–∞–º –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</li>
                            <li>–≠–∫—Å–ø–æ—Ä—Ç –≤ PDF –∏ DOCX —Ñ–æ—Ä–º–∞—Ç–∞—Ö</li>
                            <li>–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö</li>
                            <li>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</li>
                            <li>–ì—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6>–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã —ç–∫—Å–ø–æ—Ä—Ç–∞:</h6>
                        <ul>
                            <li><strong>PDF:</strong> –î–ª—è –ø–µ—á–∞—Ç–∏ –∏ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</li>
                            <li><strong>DOCX:</strong> –î–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ Word</li>
                            <li><strong>CSV:</strong> –î–ª—è –∞–Ω–∞–ª–∏–∑–∞ –≤ Excel (—Å–∫–æ—Ä–æ)</li>
                            <li><strong>JSON:</strong> –î–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –¥—Ä—É–≥–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏ (—Å–∫–æ—Ä–æ)</li>
                        </ul>
                    </div>
                </div>
                <div class="mt-3 text-center">
                    <small class="text-muted">
                        <i class="bi bi-clock"></i> –û—Ç—á–µ—Ç—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏. –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: {{ now.strftime('%d.%m.%Y %H:%M') if now else '–ù/–î' }}
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// –ü—Ä–æ—Å—Ç–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
document.addEventListener('DOMContentLoaded', function() {
    const cards = document.querySelectorAll('.report-card');
    cards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        
        setTimeout(() => {
            card.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
        }, index * 100);
    });
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
    function updateTime() {
        const now = new Date();
        const timeElement = document.querySelector('.text-muted .bi-clock').parentElement;
        if (timeElement) {
            const formattedTime = now.toLocaleString('ru-RU', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            timeElement.textContent = ' –û—Ç—á–µ—Ç—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏. –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: ' + formattedTime;
        }
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
    updateTime();
    setInterval(updateTime, 60000);
});
</script>
{% endblock %}